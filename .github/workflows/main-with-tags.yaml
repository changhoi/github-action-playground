name: Main With Tag
on: 
  push:
    branches:
      - "main"
    tags:
      - "*"
jobs:
  branch-extract:
    if: github.ref_type == 'branch'
    runs-on: ubuntu-latest
    outputs:
      branch_name: ${{github.ref_name}}
    steps:
      - run: "echo extract branch name ${{github.ref_name}}"

  stage-deploy:
    if: github.ref_type == 'branch'
    runs-on: ubuntu-latest
    steps:
      - run: echo "hello stage world"

  just-tag:
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{github.ref_name}}
    
  prod-deploy:
    needs: branch-extract
    if: |
      github.ref_type == 'tag' &&
      (needs.branch-extract-outputs.branch_name == 'main')
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{needs.branch-extract.outputs.branch_name}}
