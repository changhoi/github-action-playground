name: Main With Tag
on: 
  push:
    branches:
      - "main"
    tags:
      - "*"
jobs:
  branch-extract:
    if: github.ref_type == 'branch'
    runs-on: ubuntu-latest
    outputs:
      branch_name: ${{github.ref_name}}
  
  stage-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: "stage run"
        run: echo "hello stage world"

  just-tag:
    runs-on: ubuntu-latest
    steps:
      - name: "run by tags"
        run: echo ${{github.ref_name}}
    
  prod-deploy:
    needs: branch-extract
    if: |
      github.ref_type == 'tag' ||
      (needs.branch-extract-outputs.branch_name == 'main')
    runs-on: ubuntu-latest
    steps:
      - name: "check branch name"
        run: echo ${{needs.branch-extract.outputs.branch_name}}
